{{ define "main" }}

{{/* Breadcrumbs */}}

{{ if not .IsHome }}
{{ partial "breadcrumbs.html" . }}
{{ end }}

<div {{ if .Param "autonumber" }} class="autonumber" {{ end }}>

  <div class="single-intro-container">

    {{/* Title and Summary */}}

    <h1 class="single-title">{{ .Title }}</h1>
    {{ with .Param "summary" }}
    <p class="single-summary">{{ . | markdownify }}</p>
    {{ end }}

    {{/* Reading Time */}}

    <p class="single-readtime">
      {{ with .Date }}
      {{ $dateMachine := . | time.Format "2006-01-02T15:04:05-07:00" }}
      {{ $dateHuman := . | time.Format (default ":date_long" $.Site.Params.singleDateFormat) }}
      <time datetime="{{ $dateMachine }}">{{ $dateHuman }}</time>
      {{end}}

      {{ if .Param "readTime" }}
      &nbsp; · &nbsp;
      {{ .ReadingTime }} min read
      {{end }}
    </p>

  </div>

  {{ if .Param "showTags" }}

  {{ $taxonomy := "tags" }}
  {{ with .Param $taxonomy }}

  <div class="single-tags">
    {{ range $index, $tag := . }}
    {{ with $.Site.GetPage (printf "/%s/%s" $taxonomy $tag) -}}
    <span>
      <a href="{{ .Permalink }}">#{{ .LinkTitle }}</a>
    </span>
    {{ end }}
    {{ end }}
  </div>

  {{ end }}
  {{ end }}

  {{/* Table of Content */}}

  {{ if .Param "toc" }}
  <aside class="toc">
    <p><strong>Table of contents</strong></p>
    {{ .TableOfContents }}
  </aside>
  {{ end }}

  {{/* Page content */}}

  <div class="single-content">
    {{ .Content }}
    {{ if .Site.Params.giscus.enable }}
    {{ if not .Params.disableComment }}
    {{ partial "comments.html" . }}
    {{ end }}
    {{ end }}
  </div>

  {{ if .Store.Get "hasMermaid" }}
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>
  {{ end }}


  {{/* Next prev controls */}}

  {{ if not (.Param "hidePagination") }}
  {{ partial "pagination-single.html" . }}
  {{ end }}

  {{/* Back to top */}}

  {{ if not (.Param "hideBackToTop") }}
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  {{ end }}

  {{/* Language Navigation Buttons */}}
  {{ if not (.Param "hideLanguageButtons") }}
  <style>
    .language-buttons {
      position: fixed;
      top: 420px;
      right: 2rem;
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      opacity: 0;
      animation: fadeInButton 0.3s ease-in-out 0.5s forwards;
    }
    .language-buttons a {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.6rem 1.1rem;
      background: rgba(255, 255, 255, 0.3);
      color: var(--content-primary);
      text-decoration: none;
      border-radius: 12px;
      border: 0.5px solid rgba(255, 255, 255, 0.5);
      font-size: 0.85rem;
      font-weight: 500;
      letter-spacing: 0.01em;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05),
                  0 0 0 0.5px rgba(255, 255, 255, 0.2) inset;
    }
    .language-buttons a:hover {
      background: rgba(255, 255, 255, 0.5);
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08),
                  0 0 0 0.5px rgba(255, 255, 255, 0.3) inset;
    }
    .language-buttons a:active {
      transform: translateY(0);
    }
    @keyframes fadeInButton {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @media (max-width: 768px) {
      .language-buttons { top: 350px; right: 1rem; gap: 0.5rem; }
      .language-buttons a { padding: 0.5rem 0.9rem; font-size: 0.8rem; }
    }
  </style>
  
  <div class="language-buttons">
    <a href="#chinese-text">中文</a>
    <a href="#english-translation">English</a>
  </div>
  {{ end }}

</div>

{{ end }}
